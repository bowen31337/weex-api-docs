<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="WEEX Futures Trading API Documentation - Comprehensive endpoints for cryptocurrency derivatives trading">
    <meta name="keywords" content="WEEX, API, Futures, Trading, Cryptocurrency, Documentation">
    <title>WEEX Futures Trading API Documentation</title>
    <link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist@5.11.0/swagger-ui.css" />
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="https://www.weex.com/favicon.ico">
    <!-- Import CryptoJS for HMAC SHA256 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
</head>
<body>
    <div class="bg-blob bg-blob-1"></div>
    <div class="bg-blob bg-blob-2"></div>
    <a href="#swagger-ui" class="skip-link">Skip to API Documentation</a>
    
    <header class="weex-header">
        <a href="#" class="weex-logo">
            <span>WEEX</span> API Docs
        </a>
        <button class="mobile-menu-toggle" aria-label="Toggle navigation menu" aria-expanded="false">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12h18M3 6h18M3 18h18"/>
            </svg>
        </button>
        <nav class="header-links" aria-label="Main navigation">
            <a href="https://www.weex.com" target="_blank" rel="noopener noreferrer">WEEX Official</a>
            <a href="https://www.weex.com/help" target="_blank" rel="noopener noreferrer">Support Center</a>
            <a href="./CHANGELOG.md" target="_blank">Changelog</a>
            <a href="./openapi.json" download="weex-openapi.json">Download JSON</a>
        </nav>
    </header>

    <!-- Quick Info Banner -->
    <div class="info-banner">
        <div class="badge">
            <svg class="badge-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
            API Version 2.0
        </div>
        <div class="badge">
            <svg class="badge-icon" viewBox="0 0 24 24"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg>
            HMAC-SHA256 Auth
        </div>
        <div class="auth-info">
            <strong>üîê How to Use:</strong> 
            Click "Authorize" ‚Üí Enter API Key, Secret, Passphrase ‚Üí Timestamp auto-filled ‚Üí Signatures calculated by proxy
        </div>
    </div>

    <main id="swagger-ui" role="main"></main>

    <footer class="api-footer">
        <p>¬© 2024 WEEX. All rights reserved. | 
            <a href="https://www.weex.com/terms" target="_blank" rel="noopener noreferrer">Terms of Service</a> | 
            <a href="https://www.weex.com/privacy" target="_blank" rel="noopener noreferrer">Privacy Policy</a>
        </p>
        <p>Base URL: <code id="base-url">https://api-contract.weex.com</code> <button onclick="copyToClipboard('https://api-contract.weex.com')" class="copy-btn-mini" aria-label="Copy Base URL">Copy</button></p>
    </footer>

    <script src="https://unpkg.com/swagger-ui-dist@5.11.0/swagger-ui-bundle.js" crossorigin></script>
    <script src="https://unpkg.com/swagger-ui-dist@5.11.0/swagger-ui-standalone-preset.js" crossorigin></script>
    <script>
        window.onload = () => {
            window.ui = SwaggerUIBundle({
                url: './weex-api-spec.yaml',
                dom_id: '#swagger-ui',
                deepLinking: true,
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIStandalonePreset
                ],
                plugins: [
                    SwaggerUIBundle.plugins.DownloadUrl
                ],
                layout: "StandaloneLayout",
                
                // Enhanced configuration
                docExpansion: 'none',           // Collapse all by default
                defaultModelsExpandDepth: 2,    // Show model details
                defaultModelExpandDepth: 2,     // Expand nested models
                displayRequestDuration: true,   // Show request timing
                filter: true,                   // Enable search filter
                showExtensions: true,           // Show vendor extensions
                showCommonExtensions: true,     // Show common extensions
                tryItOutEnabled: false,         // Disable try-it-out by default (user can enable)
                persistAuthorization: true,     // Remember auth between page loads
                validatorUrl: null,             // Disable the remote validator badge
                
                // Syntax highlighting
                syntaxHighlight: {
                    activate: true,
                    theme: 'agate'
                },
                
                // Request interceptor for signature generation
                requestInterceptor: (request) => {
                    // Check if the request is destined for the WEEX API
                    if (request.url.includes('weex.com') || request.url.includes('api-contract')) {
                        const urlObj = new URL(request.url);
                        const path = urlObj.pathname;
                        
                        // Public market endpoints that don't require authentication
                        const publicEndpoints = [
                            '/capi/v2/market/time',
                            '/capi/v2/market/contracts',
                            '/capi/v2/market/depth',
                            '/capi/v2/market/tickers',
                            '/capi/v2/market/ticker',
                            '/capi/v2/market/trades',
                            '/capi/v2/market/candles',
                            '/capi/v2/market/index',
                            '/capi/v2/market/open_interest',
                            '/capi/v2/market/funding_time',
                            '/capi/v2/market/getHistoryFundRate',
                            '/capi/v2/market/currentFundRate'
                        ];
                        
                        const isPublicEndpoint = publicEndpoints.some(endpoint => path.includes(endpoint));
                        
                        // Only add auth headers for non-public endpoints
                        if (!isPublicEndpoint) {
                            const timestamp = Date.now().toString();
                            request.headers['ACCESS-TIMESTAMP'] = timestamp;
                            
                            // Ensure Content-Type is set
                            if (!request.headers['Content-Type']) {
                                request.headers['Content-Type'] = 'application/json';
                            }
                            
                            // Default locale
                            if (!request.headers['locale']) {
                                request.headers['locale'] = 'en-US';
                            }

                            // Signature Generation Logic
                            if (request.headers['ACCESS-SIGN']) {
                                try {
                                    const secretKey = request.headers['ACCESS-SIGN'];
                                    const method = request.method.toUpperCase();
                                    const body = request.body || '';
                                    
                                    // Build message: timestamp + method + path + body
                                    const message = timestamp + method + path + body;
                                    
                                    // Generate HMAC-SHA256 signature
                                    const signature = CryptoJS.HmacSHA256(message, secretKey).toString(CryptoJS.enc.Base64);
                                    
                                    request.headers['ACCESS-SIGN'] = signature;
                                    
                                    console.log('‚úÖ WEEX API Request Signed:', {
                                        timestamp: timestamp,
                                        method: method,
                                        path: path,
                                        bodyLength: body.length,
                                        signaturePreview: signature.substring(0, 20) + '...'
                                    });
                                } catch (error) {
                                    console.error('‚ùå Signature generation failed:', error);
                                }
                            }
                        } else {
                            console.log('üìä Public Market API (no auth required):', path);
                        }
                    }
                    return request;
                },
                
                // Response interceptor for debugging
                responseInterceptor: (response) => {
                    // Log response for debugging
                    if (response.url && (response.url.includes('weex.com') || response.url.includes('api-contract'))) {
                        console.log('üì• WEEX API Response:', {
                            url: response.url,
                            status: response.status,
                            duration: response.duration + 'ms'
                        });
                    }
                    return response;
                },
                
                // Custom operation sorting
                operationsSorter: (a, b) => {
                    const methodOrder = ['get', 'post', 'put', 'patch', 'delete'];
                    return methodOrder.indexOf(a.get('method')) - methodOrder.indexOf(b.get('method'));
                },
                
                // Custom tag sorting (keep original order)
                tagsSorter: 'alpha'
            });
            
            // Add keyboard shortcut for search
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    const filterInput = document.querySelector('.operation-filter-input');
                    if (filterInput) {
                        filterInput.focus();
                    }
                }
            });
            
            // Auto-populate timestamp when Authorize dialog opens
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    mutation.addedNodes.forEach((node) => {
                        if (node.nodeType === 1 && node.classList && node.classList.contains('dialog-ux')) {
                            // Find the ACCESS-TIMESTAMP input field
                            setTimeout(() => {
                                const timestampInput = document.querySelector('input[name="ACCESS-TIMESTAMP"]');
                                if (timestampInput && !timestampInput.value) {
                                    timestampInput.value = Date.now().toString();
                                    // Trigger input event to update Swagger UI state
                                    timestampInput.dispatchEvent(new Event('input', { bubbles: true }));
                                    console.log('üïê Auto-populated ACCESS-TIMESTAMP:', timestampInput.value);
                                }
                            }, 100);
                        }
                    });
                });
            });
            
            observer.observe(document.body, { childList: true, subtree: true });
            
            // Refresh timestamp every 30 seconds if dialog is open
            setInterval(() => {
                const timestampInput = document.querySelector('input[name="ACCESS-TIMESTAMP"]');
                if (timestampInput) {
                    timestampInput.value = Date.now().toString();
                    timestampInput.dispatchEvent(new Event('input', { bubbles: true }));
                }
            }, 30000);

            // Mobile menu toggle functionality
            const mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
            const headerLinks = document.querySelector('.header-links');
            
            if (mobileMenuToggle && headerLinks) {
                mobileMenuToggle.addEventListener('click', () => {
                    const isExpanded = mobileMenuToggle.getAttribute('aria-expanded') === 'true';
                    mobileMenuToggle.setAttribute('aria-expanded', !isExpanded);
                    headerLinks.classList.toggle('active');
                });

                // Close menu when clicking outside
                document.addEventListener('click', (e) => {
                    if (!headerLinks.contains(e.target) && !mobileMenuToggle.contains(e.target)) {
                        headerLinks.classList.remove('active');
                        mobileMenuToggle.setAttribute('aria-expanded', 'false');
                    }
                });

                // Close menu when clicking on a link
                headerLinks.querySelectorAll('a').forEach(link => {
                    link.addEventListener('click', () => {
                        headerLinks.classList.remove('active');
                        mobileMenuToggle.setAttribute('aria-expanded', 'false');
                    });
                });
            }

            // Spotlight Effect Implementation
            document.addEventListener('mousemove', (e) => {
                const cards = document.querySelectorAll('.swagger-ui .opblock');
                cards.forEach(card => {
                    if (!card.querySelector('.spotlight')) {
                        const spotlight = document.createElement('div');
                        spotlight.className = 'spotlight';
                        card.appendChild(spotlight);
                    }
                    
                    const rect = card.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    card.style.setProperty('--x', `${x}px`);
                    card.style.setProperty('--y', `${y}px`);
                });
            });

            // Smooth Tag Expansion Animation
            const observerTags = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    mutation.addedNodes.forEach((node) => {
                        if (node.nodeType === 1 && node.classList && node.classList.contains('opblock-tag-section')) {
                            node.style.opacity = '0';
                            node.style.transform = 'translateY(10px)';
                            setTimeout(() => {
                                node.style.transition = 'all 0.5s ease-out';
                                node.style.opacity = '1';
                                node.style.transform = 'translateY(0)';
                            }, 50);
                        }
                    });
                });
            });
            
            observerTags.observe(document.body, { childList: true, subtree: true });
        };

        // Utility: Copy to Clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                const toast = document.createElement('div');
                toast.innerText = 'Copied to clipboard!';
                toast.className = 'toast-notification';
                document.body.appendChild(toast);
                setTimeout(() => {
                    toast.classList.add('fade-out');
                    setTimeout(() => toast.remove(), 300);
                }, 2000);
            });
        }
    </script>
</body>
</html>
